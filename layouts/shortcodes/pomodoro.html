<div id="pomodoro-timer">
<style>
  #controls button,
  #mode-switcher button {
    padding: 6px 12px; /* Balanced padding for symmetry */
    font-size: 0.9rem; /* Slightly smaller font for minimalism */
    font-weight: 600; /* Balanced font weight */
    border-radius: 18px; /* Slightly rounded corners for modern aesthetics */
    cursor: pointer;
    background-color: #f4f4f4; /* Neutral background */
    color: #333; /* Dark text for contrast */
    transition: all 0.2s ease; /* Smooth hover effect */
    border: 2px solid #ccc; /* Subtle border */
  }

  #controls button:hover,
  #mode-switcher button:hover {
    background-color: #ddd; /* Subtle hover feedback */
  }

  #controls button:active,
  #mode-switcher button:active {
    background-color: #bbb; /* Slightly darker when pressed */
  }

  #mode-switcher .active {
    background-color: #429b46;
    color: white; /* White text for contrast */
  }

  #controls {
    display: flex;
    justify-content: center;
    gap: 8px; /* Reduced gap for a tighter layout */
  }

  #mode-switcher {
    /* margin-top: 16px; */
    display: flex;
    justify-content: center;
    gap: 8px; /* Consistent gap between mode buttons */
  }

  select#audio-select {
    padding: 8px 12px; /* Tight padding */
    font-size: 0.9rem; /* Match button font size */
    border: 2px solid #ccc; /* Subtle border */
    border-radius: 18px; /* Rounded corners */
    background-color: #f4f4f4; /* Dark background */
    font-weight: 600; /* Balanced font weight */
    color: #429b46; /*Dark text for contrast
    transition: all 0.2s ease; /* Smooth hover effect */
  }

  #header-container {
    display: flex;
    align-items: center; /* Vertically center the text */
    justify-content: flex-start; /* Align items to the left */
    gap: 18px; /* Add spacing between the heading and the timer */
    justify-content: center;
  }

  #time-display {
    font-size: 2rem; /* Adjust font size for timer display */
    font-weight: bold; /* Make it bold for emphasis */
    color: rgb(33, 84, 161);
  }
</style>

<center>
<h4>“Let's learn to be calm and you will always be happy!“ <br />
Sit in the tranquility beside the river and concentrate on your breath.</h4>
</center>

<div id="header-container">
  <h3>Pomodoro Timer |</h3>
  <div id="time-display">25:00</div>
</div>

  <div id="controls">
    <button id="start-timer">&#9654;</button>
    <button id="pause-timer" disabled>&#10073;&#10073;</button>
    <button id="reset-timer">&#x27F3;</button>

    <div id="mode-switcher">
        <button id="pomodoro-mode" class="active">Pomodoro</button>
        <button id="short-break-mode">Short Break</button>
        <button id="long-break-mode">Long Break</button>

    </div>
    <div id="audio-controls">
        <select id="audio-select">
            <option value="" selected disabled>Select a Harmony</option>
            {{ range (split (.Get "audioFiles") ",") }}
            <option value="{{ . }}">{{ . | replaceRE "^.*/" "" | replaceRE "\\.[^.]+$" "" }}</option>
            {{ end }}
        </select>
    </div>
  </div>

  <audio id="audio" loop preload="none"></audio>
  <audio id="chime" src="chime.mp3" preload="auto"></audio>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const timeDisplay = document.getElementById("time-display");
      const startButton = document.getElementById("start-timer");
      const pauseButton = document.getElementById("pause-timer");
      const resetButton = document.getElementById("reset-timer");
      const modeButtons = {
        pomodoro: document.getElementById("pomodoro-mode"),
        shortBreak: document.getElementById("short-break-mode"),
        longBreak: document.getElementById("long-break-mode"),
      };
      const audioSelect = document.getElementById("audio-select");
      const audioPlayer = document.getElementById("audio");
      const chimeAudio = document.getElementById("chime");

      const times = {
        pomodoro: 1 * 60, // 25 minutes
        shortBreak: 5 * 60, // 5 minutes
        longBreak: 10 * 60, // 15 minutes
      };
      let currentMode = "pomodoro";
      let timeRemaining = times[currentMode];
      let timerInterval = null;
      let isPlaying = false;

      function updateDisplay() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timeDisplay.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
      }

      function switchMode(mode) {
        currentMode = mode;
        timeRemaining = times[mode];
        updateDisplay();
        for (const button of Object.values(modeButtons)) {
          button.classList.remove("active");
        }
        modeButtons[mode].classList.add("active");
        resetTimer();
      }

      function startTimer() {
        if (!audioPlayer.src && currentMode === "pomodoro") {
          alert("Please select an audio file to play while the timer runs.");
          return;
        }
        if (timerInterval) return;

        if (currentMode === "pomodoro") {
          isPlaying = true;
          audioPlayer.play();
        }

        timerInterval = setInterval(() => {
          if (timeRemaining > 0) {
            timeRemaining--;
            updateDisplay();
          } else {
            clearInterval(timerInterval);
            timerInterval = null;
            isPlaying = false;
            audioPlayer.pause();
            chimeAudio.play(); // Play the chime when the timer ends
            alert(`${currentMode === "pomodoro" ? "Pomodoro" : "Break"} complete!`);
          }
        }, 1000);

        startButton.disabled = true;
        pauseButton.disabled = false;
      }

      function pauseTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        if (currentMode === "pomodoro" && isPlaying) {
          audioPlayer.pause();
        }
        isPlaying = false;
        startButton.disabled = false;
        pauseButton.disabled = true;
      }

      function resetTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        timeRemaining = times[currentMode];
        updateDisplay();
        if (currentMode === "pomodoro" && isPlaying) {
          audioPlayer.pause();
        }
        isPlaying = false;
        startButton.disabled = false;
        pauseButton.disabled = true;
      }

      function updateAudioSource() {
        const selectedAudio = audioSelect.value;
        if (selectedAudio) {
          audioPlayer.src = selectedAudio;
          audioPlayer.load();
        }
      }

      // Event Listeners
      startButton.addEventListener("click", startTimer);
      pauseButton.addEventListener("click", pauseTimer);
      resetButton.addEventListener("click", resetTimer);
      audioSelect.addEventListener("change", updateAudioSource);
      modeButtons.pomodoro.addEventListener("click", () => switchMode("pomodoro"));
      modeButtons.shortBreak.addEventListener("click", () => switchMode("shortBreak"));
      modeButtons.longBreak.addEventListener("click", () => switchMode("longBreak"));

      // Initialize
      updateDisplay();
    });
  </script>
</div>
